# Makefile that knows how to download things

RSYNC=rsync -W
RSYNC_LOCATION={{rsync_location}}

MONET_TARBALL_FILE={{ monet_tarball_prefix }}-{{ monetdb_version }}.{{ system_spec }}.tar.bz2
MONET_TARBALL_URL=https://www.monetdbsolutions.com/downloads/HTM/$(MONET_TARBALL_FILE)



# default is to download nothing
default:

kvm_host: {{centos_img_file}} {{qemu_efi_img_file}}

# We only support rsync right now

{{centos_img_file}}:
{% if rsync_location %}
	$(RSYNC) $(RSYNC_LOCATION)/qemu-images/$@ $@.tmp
{% else %}
	curl -s -o "$@.tmp" 'http://mirror.centos.org/altarch/7/isos/aarch64/CentOS-7-aarch64.img.xz'
{% endif %}
	mv $@.tmp $@

{{qemu_efi_img_file}}:
{% if rsync_location %}
	$(RSYNC) $(RSYNC_LOCATION)/qemu-images/$@ $@.tmp
{% else %}
	curl -s -o "$@.tmp" 'http://www.exanest.eu/wiki/images/c/c2/QEMU_EFI.fd.tar.gz'
{% endif %}
	mv $@.tmp $@


monetdb: $(MONET_TARBALL_FILE).extracted

$(MONET_TARBALL_FILE).extracted: $(MONET_TARBALL_FILE)
	tar jxf $<
	touch $@

$(MONET_TARBALL_FILE):
	curl -s -o "$@.tmp" $(MONET_TARBALL_URL)
	mv $@.tmp $@

